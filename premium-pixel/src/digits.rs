pub mod large {
    use crate::Surface;

    /// Write on a surface using the large digit typeface
    pub trait DigitsLarge {
        /// Write the text with the baseline starting at the given position.
        /// Returns the width of the text in pixels.
        fn digits_large(&mut self, x: i32, y: i32, text: &str) -> i32;
    }

    impl<S: Surface> DigitsLarge for S {
        fn digits_large(&mut self, x: i32, y: i32, text: &str) -> i32 {
            let mut w = 0;
            for (i, c) in text.chars().enumerate() {
                if i > 0 {
                    w += 4;
                }
                w += glyph(self, x + w, y, c);
            }
            w
        }
    }

    fn glyph<S: Surface>(surface: &mut S, x: i32, y: i32, c: char) -> i32 {
        let (c, w, o) = lookup(c);
        let h = c.len() as i32;
        for (i, l) in c.iter().enumerate() {
            for j in 0..16 {
                if l & (1 << (15 - j)) != 0 {
                    surface.pixel(x + j, y - h + o + i as i32);
                }
            }
        }
        w
    }

    fn lookup(c: char) -> (&'static [u16], i32, i32) {
        match c {
            '0' => (
                &[
                    0b0000111111110000,
                    0b0011111111111100,
                    0b0111111111111110,
                    0b0111100000011110,
                    0b1111000000001111,
                    0b1110000000000111,
                    0b1110000000000111,
                    0b1110000000000111,
                    0b1110000000000111,
                    0b1110000000000111,
                    0b1110000000000111,
                    0b1110000000000111,
                    0b1110000000000111,
                    0b1110000000000111,
                    0b1110000000000111,
                    0b1110000000000111,
                    0b1110000000000111,
                    0b1110000000000111,
                    0b1110000000000111,
                    0b1111000000001111,
                    0b0111100000011110,
                    0b0111111111111110,
                    0b0011111111111100,
                    0b0000111111110000,
                ],
                16,
                0,
            ),
            '1' => (
                &[
                    0b0000000011000000,
                    0b0000001111000000,
                    0b0000111111000000,
                    0b0011111111000000,
                    0b0011111111000000,
                    0b0000000111000000,
                    0b0000000111000000,
                    0b0000000111000000,
                    0b0000000111000000,
                    0b0000000111000000,
                    0b0000000111000000,
                    0b0000000111000000,
                    0b0000000111000000,
                    0b0000000111000000,
                    0b0000000111000000,
                    0b0000000111000000,
                    0b0000000111000000,
                    0b0000000111000000,
                    0b0000000111000000,
                    0b0000000111000000,
                    0b0000000111000000,
                    0b0011111111111110,
                    0b0011111111111110,
                    0b0011111111111110,
                ],
                16,
                0,
            ),
            '2' => (
                &[
                    0b0000111111110000,
                    0b0011111111111100,
                    0b0111111111111110,
                    0b0111100000011110,
                    0b1111000000001111,
                    0b1110000000000111,
                    0b1110000000000111,
                    0b0000000000000111,
                    0b0000000000000111,
                    0b0000000000001110,
                    0b0000000000011110,
                    0b0000000000111100,
                    0b0000000001111000,
                    0b0000000011110000,
                    0b0000000111100000,
                    0b0000001111000000,
                    0b0000011110000000,
                    0b0000111100000000,
                    0b0001111000000000,
                    0b0011110000000000,
                    0b0111100000000000,
                    0b1111111111111111,
                    0b1111111111111111,
                    0b1111111111111111,
                ],
                16,
                0,
            ),
            '3' => (
                &[
                    0b0000111111110000,
                    0b0011111111111100,
                    0b0111111111111110,
                    0b0111100000011110,
                    0b1111000000001111,
                    0b1110000000000111,
                    0b1110000000000111,
                    0b0000000000000111,
                    0b0000000000001111,
                    0b0000000000011110,
                    0b0000000011111110,
                    0b0000000011111100,
                    0b0000000011111110,
                    0b0000000000011110,
                    0b0000000000001111,
                    0b0000000000000111,
                    0b0000000000000111,
                    0b1110000000000111,
                    0b1110000000000111,
                    0b1111000000001111,
                    0b0111100000011110,
                    0b0111111111111110,
                    0b0011111111111100,
                    0b0000111111110000,
                ],
                16,
                0,
            ),
            '4' => (
                &[
                    0b1110000000111000,
                    0b1110000000111000,
                    0b1110000000111000,
                    0b1110000000111000,
                    0b1110000000111000,
                    0b1110000000111000,
                    0b1110000000111000,
                    0b1110000000111000,
                    0b1110000000111000,
                    0b1110000000111000,
                    0b1110000000111000,
                    0b1111111111111111,
                    0b1111111111111111,
                    0b1111111111111111,
                    0b0000000000111000,
                    0b0000000000111000,
                    0b0000000000111000,
                    0b0000000000111000,
                    0b0000000000111000,
                    0b0000000000111000,
                    0b0000000000111000,
                    0b0000000000111000,
                    0b0000000000111000,
                    0b0000000000111000,
                ],
                16,
                0,
            ),
            '5' => (
                &[
                    0b1111111111111111,
                    0b1111111111111111,
                    0b1111111111111111,
                    0b1110000000000111,
                    0b1110000000000111,
                    0b1110000000000000,
                    0b1110000000000000,
                    0b1110000000000000,
                    0b1110000000000000,
                    0b1110000000000000,
                    0b1111111111110000,
                    0b1111111111111100,
                    0b1111111111111110,
                    0b0000000000011110,
                    0b0000000000001111,
                    0b0000000000000111,
                    0b0000000000000111,
                    0b1110000000000111,
                    0b1110000000000111,
                    0b1111000000001111,
                    0b0111100000011110,
                    0b0111111111111110,
                    0b0011111111111100,
                    0b0000111111110000,
                ],
                16,
                0,
            ),
            '6' => (
                &[
                    0b0000111111110000,
                    0b0011111111111100,
                    0b0111111111111110,
                    0b0111100000011110,
                    0b1111000000001111,
                    0b1110000000000111,
                    0b1110000000000111,
                    0b1110000000000000,
                    0b1110000000000000,
                    0b1110000000000000,
                    0b1110111111110000,
                    0b1111111111111100,
                    0b1111111111111110,
                    0b1111100000011110,
                    0b1111000000001111,
                    0b1110000000000111,
                    0b1110000000000111,
                    0b1110000000000111,
                    0b1110000000000111,
                    0b1111000000001111,
                    0b0111100000011110,
                    0b0111111111111110,
                    0b0011111111111100,
                    0b0000111111110000,
                ],
                16,
                0,
            ),
            '7' => (
                &[
                    0b1111111111111111,
                    0b1111111111111111,
                    0b1111111111111111,
                    0b1110000000000111,
                    0b1110000000000111,
                    0b0000000000001111,
                    0b0000000000001110,
                    0b0000000000011110,
                    0b0000000000011100,
                    0b0000000000111100,
                    0b0000000000111000,
                    0b0000000001111000,
                    0b0000000001110000,
                    0b0000000011110000,
                    0b0000000011100000,
                    0b0000000111100000,
                    0b0000000111000000,
                    0b0000001111000000,
                    0b0000001110000000,
                    0b0000011110000000,
                    0b0000011100000000,
                    0b0000111100000000,
                    0b0000111000000000,
                    0b0000111000000000,
                ],
                16,
                0,
            ),
            '8' => (
                &[
                    0b0000111111110000,
                    0b0011111111111100,
                    0b0111111111111110,
                    0b0111100000011110,
                    0b1111000000001111,
                    0b1110000000000111,
                    0b1110000000000111,
                    0b1110000000000111,
                    0b1111000000001111,
                    0b0111100000011110,
                    0b0111111111111110,
                    0b0011111111111100,
                    0b0111111111111110,
                    0b0111100000011110,
                    0b1111000000001111,
                    0b1110000000000111,
                    0b1110000000000111,
                    0b1110000000000111,
                    0b1110000000000111,
                    0b1111000000001111,
                    0b0111100000011110,
                    0b0111111111111110,
                    0b0011111111111100,
                    0b0000111111110000,
                ],
                16,
                0,
            ),
            '9' => (
                &[
                    0b0000111111110000,
                    0b0011111111111100,
                    0b0111111111111110,
                    0b0111100000011110,
                    0b1111000000001111,
                    0b1110000000000111,
                    0b1110000000000111,
                    0b1110000000000111,
                    0b1110000000000111,
                    0b1111000000001111,
                    0b0111100000011111,
                    0b0011111111111111,
                    0b0011111111111111,
                    0b0000111111110111,
                    0b0000000000000111,
                    0b0000000000000111,
                    0b0000000000000111,
                    0b1110000000000111,
                    0b1110000000000111,
                    0b1111000000001111,
                    0b0111100000011110,
                    0b0111111111111110,
                    0b0011111111111100,
                    0b0000111111110000,
                ],
                16,
                0,
            ),
            ':' => (
                &[
                    0b0110000000000000,
                    0b1111000000000000,
                    0b1111000000000000,
                    0b0110000000000000,
                    0b0000000000000000,
                    0b0000000000000000,
                    0b0000000000000000,
                    0b0000000000000000,
                    0b0000000000000000,
                    0b0110000000000000,
                    0b1111000000000000,
                    0b1111000000000000,
                    0b0110000000000000,
                ],
                4,
                -5,
            ),
            '.' => (
                &[
                    0b0110000000000000,
                    0b1111000000000000,
                    0b1111000000000000,
                    0b0110000000000000,
                ],
                4,
                0,
            ),
            ',' => (
                &[
                    0b0111000000000000,
                    0b0111000000000000,
                    0b0110000000000000,
                    0b1110000000000000,
                    0b1100000000000000,
                    0b1100000000000000,
                ],
                4,
                2,
            ),
            '+' => (
                &[
                    0b0001110000000000,
                    0b0001110000000000,
                    0b0001110000000000,
                    0b1111111110000000,
                    0b1111111110000000,
                    0b1111111110000000,
                    0b0001110000000000,
                    0b0001110000000000,
                    0b0001110000000000,
                ],
                9,
                -7,
            ),
            '-' => (
                &[0b1111111110000000, 0b1111111110000000, 0b1111111110000000],
                9,
                -10,
            ),
            '°' => (
                &[
                    0b0111100000000000,
                    0b1111110000000000,
                    0b1100110000000000,
                    0b1100110000000000,
                    0b1111110000000000,
                    0b0111100000000000,
                ],
                6,
                -18,
            ),
            'C' => (
                &[
                    0b0000111111110000,
                    0b0011111111111100,
                    0b0111111111111110,
                    0b0111100000011110,
                    0b1111000000001111,
                    0b1110000000000111,
                    0b1110000000000111,
                    0b1110000000000000,
                    0b1110000000000000,
                    0b1110000000000000,
                    0b1110000000000000,
                    0b1110000000000000,
                    0b1110000000000000,
                    0b1110000000000000,
                    0b1110000000000000,
                    0b1110000000000000,
                    0b1110000000000000,
                    0b1110000000000111,
                    0b1110000000000111,
                    0b1111000000001111,
                    0b0111100000011110,
                    0b0111111111111110,
                    0b0011111111111100,
                    0b0000111111110000,
                ],
                16,
                0,
            ),
            '\t' => (&[], 9, 0),
            ' ' => (&[], 4, 0),
            _ => (&[], -4, 0),
        }
    }
}

pub mod medium {
    use crate::Surface;

    /// Write on a surface using the medium digit typeface
    pub trait DigitsMedium {
        /// Write the text with the baseline starting at the given position.
        /// Returns the width of the text in pixels.
        fn digits_medium(&mut self, x: i32, y: i32, text: &str) -> i32;
    }

    impl<S: Surface> DigitsMedium for S {
        fn digits_medium(&mut self, x: i32, y: i32, text: &str) -> i32 {
            let mut w = 0;
            for (i, c) in text.chars().enumerate() {
                if i > 0 {
                    w += 2;
                }
                w += glyph(self, x + w, y, c);
            }
            w
        }
    }

    fn glyph<S: Surface>(surface: &mut S, x: i32, y: i32, c: char) -> i32 {
        let (c, w, o) = lookup(c);
        let h = c.len() as i32;
        for (i, l) in c.iter().enumerate() {
            for j in 0..16 {
                if l & (1 << (15 - j)) != 0 {
                    surface.pixel(x + j, y - h + o + i as i32);
                }
            }
        }
        w
    }

    fn lookup(c: char) -> (&'static [u16], i32, i32) {
        match c {
            '0' => (
                &[
                    0b0011111100000000,
                    0b0111111110000000,
                    0b1110000111000000,
                    0b1100000011000000,
                    0b1100000011000000,
                    0b1100000011000000,
                    0b1100000011000000,
                    0b1100000011000000,
                    0b1100000011000000,
                    0b1100000011000000,
                    0b1100000011000000,
                    0b1100000011000000,
                    0b1100000011000000,
                    0b1110000111000000,
                    0b0111111110000000,
                    0b0011111100000000,
                ],
                10,
                0,
            ),
            '1' => (
                &[
                    0b0000110000000000,
                    0b0011110000000000,
                    0b1111110000000000,
                    0b0000110000000000,
                    0b0000110000000000,
                    0b0000110000000000,
                    0b0000110000000000,
                    0b0000110000000000,
                    0b0000110000000000,
                    0b0000110000000000,
                    0b0000110000000000,
                    0b0000110000000000,
                    0b0000110000000000,
                    0b0000110000000000,
                    0b0111111110000000,
                    0b0111111110000000,
                ],
                10,
                0,
            ),
            '2' => (
                &[
                    0b0011111100000000,
                    0b0111111110000000,
                    0b1110000111000000,
                    0b1100000011000000,
                    0b0000000011000000,
                    0b0000000011000000,
                    0b0000000011000000,
                    0b0000000110000000,
                    0b0000001110000000,
                    0b0000011100000000,
                    0b0000111000000000,
                    0b0001110000000000,
                    0b0011100000000000,
                    0b0111000000000000,
                    0b1111111111000000,
                    0b1111111111000000,
                ],
                10,
                0,
            ),
            '3' => (
                &[
                    0b0011111100000000,
                    0b0111111110000000,
                    0b1110000111000000,
                    0b1100000011000000,
                    0b0000000011000000,
                    0b0000000011000000,
                    0b0000000111000000,
                    0b0000011110000000,
                    0b0000011110000000,
                    0b0000000111000000,
                    0b0000000011000000,
                    0b0000000011000000,
                    0b1100000011000000,
                    0b1110000111000000,
                    0b0111111110000000,
                    0b0011111100000000,
                ],
                10,
                0,
            ),
            '4' => (
                &[
                    0b1100001100000000,
                    0b1100001100000000,
                    0b1100001100000000,
                    0b1100001100000000,
                    0b1100001100000000,
                    0b1100001100000000,
                    0b1100001100000000,
                    0b1111111111000000,
                    0b1111111111000000,
                    0b0000001100000000,
                    0b0000001100000000,
                    0b0000001100000000,
                    0b0000001100000000,
                    0b0000001100000000,
                    0b0000001100000000,
                    0b0000001100000000,
                ],
                10,
                0,
            ),
            '5' => (
                &[
                    0b1111111111000000,
                    0b1111111111000000,
                    0b1100000011000000,
                    0b1100000000000000,
                    0b1100000000000000,
                    0b1100000000000000,
                    0b1100000000000000,
                    0b1111111110000000,
                    0b1111111111000000,
                    0b0000000111000000,
                    0b0000000011000000,
                    0b0000000011000000,
                    0b1100000011000000,
                    0b1110000111000000,
                    0b0111111110000000,
                    0b0011111100000000,
                ],
                10,
                0,
            ),
            '6' => (
                &[
                    0b0011111100000000,
                    0b0111111110000000,
                    0b1110000111000000,
                    0b1100000011000000,
                    0b1100000000000000,
                    0b1100000000000000,
                    0b1100000000000000,
                    0b1101111110000000,
                    0b1111111111000000,
                    0b1110000111000000,
                    0b1100000011000000,
                    0b1100000011000000,
                    0b1100000011000000,
                    0b1110000111000000,
                    0b0111111110000000,
                    0b0011111100000000,
                ],
                10,
                0,
            ),
            '7' => (
                &[
                    0b1111111111000000,
                    0b1111111111000000,
                    0b1100000011000000,
                    0b0000000011000000,
                    0b0000000110000000,
                    0b0000000110000000,
                    0b0000001100000000,
                    0b0000001100000000,
                    0b0000011000000000,
                    0b0000011000000000,
                    0b0000110000000000,
                    0b0000110000000000,
                    0b0001100000000000,
                    0b0001100000000000,
                    0b0011000000000000,
                    0b0011000000000000,
                ],
                10,
                0,
            ),
            '8' => (
                &[
                    0b0011111100000000,
                    0b0111111110000000,
                    0b1110000111000000,
                    0b1100000011000000,
                    0b1100000011000000,
                    0b1100000011000000,
                    0b1110000111000000,
                    0b0111111110000000,
                    0b0111111110000000,
                    0b1110000111000000,
                    0b1100000011000000,
                    0b1100000011000000,
                    0b1100000011000000,
                    0b1110000111000000,
                    0b0111111110000000,
                    0b0011111100000000,
                ],
                10,
                0,
            ),
            '9' => (
                &[
                    0b0011111100000000,
                    0b0111111110000000,
                    0b1110000111000000,
                    0b1100000011000000,
                    0b1100000011000000,
                    0b1100000011000000,
                    0b1110000111000000,
                    0b1111111111000000,
                    0b0111111011000000,
                    0b0000000011000000,
                    0b0000000011000000,
                    0b0000000011000000,
                    0b1100000011000000,
                    0b1110000111000000,
                    0b0111111110000000,
                    0b0011111100000000,
                ],
                10,
                0,
            ),
            ':' => (
                &[
                    0b0110000000000000,
                    0b0110000000000000,
                    0b0000000000000000,
                    0b0000000000000000,
                    0b0000000000000000,
                    0b0000000000000000,
                    0b0110000000000000,
                    0b0110000000000000,
                ],
                4,
                -4,
            ),
            '.' => (&[0b0110000000000000, 0b0110000000000000], 4, 0),
            ',' => (
                &[
                    0b0110000000000000,
                    0b0110000000000000,
                    0b1100000000000000,
                    0b1100000000000000,
                ],
                4,
                2,
            ),
            '+' => (
                &[
                    0b0011000000000000,
                    0b0011000000000000,
                    0b1111110000000000,
                    0b1111110000000000,
                    0b0011000000000000,
                    0b0011000000000000,
                ],
                6,
                -5,
            ),
            '-' => (&[0b1111110000000000, 0b1111110000000000], 6, -7),
            '°' => (
                &[0b1110000000000000, 0b1010000000000000, 0b1110000000000000],
                3,
                -13,
            ),
            'C' => (
                &[
                    0b0011111100000000,
                    0b0111111110000000,
                    0b1110000111000000,
                    0b1100000011000000,
                    0b1100000000000000,
                    0b1100000000000000,
                    0b1100000000000000,
                    0b1100000000000000,
                    0b1100000000000000,
                    0b1100000000000000,
                    0b1100000000000000,
                    0b1100000000000000,
                    0b1100000011000000,
                    0b1110000111000000,
                    0b0111111110000000,
                    0b0011111100000000,
                ],
                10,
                0,
            ),
            '\t' => (&[], 9, 0),
            ' ' => (&[], 2, 0),
            _ => (&[], -2, 0),
        }
    }
}
